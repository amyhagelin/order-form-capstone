<!DOCTYPE html>
<html>
<head>
	<title>Orders</title>
	<link rel="stylesheet" type="text/css" href="main.css">
	<link href="https://fonts.googleapis.com/css?family=Nunito" rel="stylesheet">
</head>
<body>
	<div class="home-image">
		<div class="login-container">
			<form id="login-form">
				Username: <input type="text" name="username"><br>
				Password: <input type="text" name="password"><br>
				<button>Submit</button>
			</form>
		</div>
	</div>
	<div id="welcome"></div>
	<div id="orders"></div>
	<script
		src="https://code.jquery.com/jquery-3.1.1.min.js"
		integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
		crossorigin="anonymous"></script>
	<script type="text/javascript">
	$(function() {
		watchSubmit();
	})

	function renderWelcome(user) {
		var welcomeMessage = 
		'<h3>Welcome, ' + user.firstName + ' ' + user.lastName + '!</h3>';
		 $('#welcome').html(welcomeMessage);
	}

	function renderOrders(orders) {
		var htmlOrders = orders.map(function(order) {
			return '<tr><td>' + order.name + '</td><td>' + order.email + '</td><td>' + order.phone + '</td><td>' + order.pickupDate + '</td><td><button>View Order</button></td><td><button>Delete</button></td><td><button>Assign to Me</button></td></tr>';
		})

		console.log(htmlOrders)

		var table = '<table><thead><tr><th>Name</th><th>Email</th><th>Phone</th>' + '<th>Pickup Date</th><th>View Order</th><th>Delete</th><th>Assign to Me</th></tr></thead><tbody>' + htmlOrders 
			+ '</tbody></table>';

		$('#orders').html(table)
	}

	function watchSubmit() {
		$(document).on('submit', '#login-form', function(e) {
			console.log('submit')
			e.preventDefault();

			// var loginFormData = {}

			// $('#login-form input').each(function() {
			// 	loginFormData[$(this).attr('name')] = $(this).val()
			// })

			var username = $('#login-form input[name="username"]').val()
			var password = $('#login-form input[name="password"]').val()
			var authHeader = 'Basic ' + btoa(username + ':' + password)

			console.log(authHeader)

			$.ajax({
			  url: "/users/me",
			  method: "GET",
			  headers: {
			  	Authorization: authHeader
			  },
			  // data: JSON.stringify(loginFormData),
			  contentType: "application/json"
			})
			.done(function( data ) {
    			// alert( "Data Loaded: " + data.user.firstName );
    			renderWelcome(data.user);
    			$( '#login-form' ).hide();
			
				$.ajax({
				  url: "/orders",
				  method: "GET",
				  // headers: {
				  // 	Authorization: authHeader
				  // },
				  // data: JSON.stringify(loginFormData),
				  contentType: "application/json"
				})
				.done(function(data) {
					renderOrders(data)
					// console.log(data);
				})

	  		});
		})
	}
	</script>
</body>
</html>